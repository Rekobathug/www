<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Settings</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="layout.css" type="text/css"/>
        <script src="functions.js"></script>
        
        <script>
            window.onload = get_org_details();

            // name of elementes to turn disabel
            var org_details_fields = ['org-name', 'org-description', 'org-email', 'org-phonenumber', 'org-save'];


            // name of inputs to check
            var org_details = ['org-name', 'org-description', 'org-email', 'org-phonenumber'];
            function get_org_details() {

                var request = new XMLHttpRequest();
                //Create event handler that specifies what should happen when server responds
                request.onload = function () {
                    alert(request.responseText);
                    orgDetails = JSON.parse(request.responseText);
                    if (orgDetails.hasOwnProperty("message")) {
                        document.getElementById("message_details").innerHTML = orgDetails["message"];
                    } else {
                        document.getElementById("org-name").value = orgDetails["orgname"];
                        document.getElementById("org-image-view").src = value = orgDetails["icon"];
                        document.getElementById("org-description").value = orgDetails["description"];
                        document.getElementById("org-email").value = orgDetails["email"];
                        document.getElementById("org-phonenumber").value = orgDetails["phonenumber"];

                    }
                };
                //Set up and send request
                request.open("GET", "PHP_Org/get_org_details.php");
                request.send();
            }

            function update_org_details() {
                var val = validation_form(org_details, 'message-org-details');
                if (val) {
                    var request = new XMLHttpRequest();
                    //Create event handler that specifies what should happen when server responds
                    request.onload = function () {
                        //Check HTTP status code
                        if (request.status === 200) {
                            //Get data from server
                            var responseData = request.responseText;
                            document.getElementById("message-org-details").innerHTML = responseData;
                            org_details_fields.forEach(disabel_input);
                        } else
                            alert("Error communicating with server: " + request.status);
                    };
                    //Set up request with HTTP method and URL 
                    request.open("POST", "PHP_Org/update_org_details.php");
                    request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

                    //Extract data
                    var orgName = document.getElementById("org-name").value;
                    var orgDescription = document.getElementById("org-description").value;
                    var orgEmail = document.getElementById("org-email").value;
                    var orgPhonenumber = document.getElementById("org-phonenumber").value;

                    //Send request
                    request.send("orgname=" + orgName +
                            "&description=" + orgDescription +
                            "&email=" + orgEmail +
                            "&phonenumber=" + orgPhonenumber);
                } else {
                    document.getElementById("message-org-details").innerHTML = "Complete empty fields:";
                }
            }

        </script>
    </head>
    <body>
    <center>
        <div  id="org-settings" style="width:88%; float: right; border: 1px solid black; height: 600px;">
            <div style="width:49%; float: left;" >
            <a  style="float:right;">Delete</a>
            <h4>Info</h4>
            Org Name :
            <input type="text"  name="phonenumber" id="org-name" required disabled><br><br>
            Description :
            <textarea rows="4" cols="50" name="org-description" id="org-description" required disabled></textarea><br><br>
            Email:
            <input type="text"  name="email" id="org-email" required disabled><br><br>
            Phone number:
            <input type="text"  name="phonenumber" id="org-phonenumber" required disabled><br>
            <span id='message-org-details'></span><br>
            <button  onclick="org_details_fields.forEach(enabel_input);">Edit</button><button  onclick="update_org_details()" id='org-save' disabled>Save</button>
            </div>
            
            
            
            <div id="org-icon-view" style="width:49%; float: right;" >
            <img alt="org image" id="org-image-view" src="images/community-icon.png" width="250"><br>
            <button onclick="visibility(['org-icon-change', 'org-icon-view']);">Change</button>
            </div> 
            <div id="org-icon-change" style="width:49%; float: right; display: none;" >
                 <form action="PHP_Org/upload_org_image.php" method="post" enctype="multipart/form-data" target="view_imageToUpload">
                    Select image to upload:
                    <input type="file" name="imageToUpload" id="org-image" >
                    <input type="submit" value="Upload Image" name="submit">
                </form> 
                <iframe style="width: 390px; height: 300px;" name="view_imageToUpload"></iframe>
            <a onclick="visibility(['org-icon-view','org-icon-change']);get_org_details();">Cancel</a>
            </div> 
        </div>
    </center>
    </body>
</html>
